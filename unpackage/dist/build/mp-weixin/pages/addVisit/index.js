(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/addVisit/index"],{2449:function(e,n,t){"use strict";(function(e){Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var i=r(t("a34a")),a=t("31d4"),o=t("e997");function r(e){return e&&e.__esModule?e:{default:e}}function u(e,n,t,i,a,o,r){try{var u=e[o](r),c=u.value}catch(s){return void t(s)}u.done?n(c):Promise.resolve(c).then(i,a)}function c(e){return function(){var n=this,t=arguments;return new Promise((function(i,a){var o=e.apply(n,t);function r(e){u(o,i,a,r,c,"next",e)}function c(e){u(o,i,a,r,c,"throw",e)}r(void 0)}))}}function s(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}var d=function(){t.e("components/selected/selected").then(function(){return resolve(t("4011"))}.bind(null,t)).catch(t.oe)},l={components:{choiceSelected:d},data:function(){var e;return{choiceList:[{choiceItemId:"0",choiceItemContent:"大陆身份证"}],choiceContent:"大陆身份证",choiceIndex:0,valiFormData:(e={name:"",age:"",cardNumber:"",phone:"",code:""},s(e,"age",""),s(e,"birthday",""),s(e,"sex",""),s(e,"isDefault",!0),e),time:"",text:"获取验证码",disabled:!1,isCanClick:!1,rules:{validateTrigger:"bind",code:{rules:[{required:!0,errorMessage:"验证码不能为空"}]}}}},computed:{},methods:{onChoiceClick:function(e){var n=this;n.choiceIndex=e,n.choiceContent=n.choiceList[e].choiceItemContent},onSwitchChange:function(e){console.log("change",e),this.valiFormData.isDefault=e},getSmsCode:function(){this.$validate.isPhone(this.valiFormData.phone)?(this.disabled=!0,this.sendSmsCode(),this.setInterValFunc()):e.showToast({icon:"none",title:"请输入正确的手机号"})},sendSmsCode:function(){var e=this;return c(i.default.mark((function n(){var t,a,r;return i.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:return t=e,a={mobile:t.valiFormData.phone},n.next=4,(0,o.sendSms)(a);case 4:r=n.sent,r.code&&e.$tools.message("发送成功","suc");case 6:case"end":return n.stop()}}),n)})))()},setInterValFunc:function(){var e=this;this.time=60,this.text="秒",this.setTime=setInterval((function(){e.time-1==0?(e.time="",e.text="重新获取",e.code="",e.disabled=!1,clearInterval(e.setTime)):e.time--}),1e3)},smsCode:function(e){var n=this;e=e.match(/^\d{0,6}/g)[0]||"",this.$nextTick((function(){n.valiFormData.code=e}))},checkAdd:function(){var n=[{name:"name",required:!0,type:"regex",errmsg:"请输入正确的名字",regex:/^(?:[\u4e00-\u9fa5·]{2,16})$/},{name:"cardNumber",required:!0,type:"regex",errmsg:"请输入正确的身份证号码",regex:/^[1-9]\d{5}(18|19|20|(3\d))\d{2}((0[1-9])|(1[0-2]))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$/},{name:"phone",required:!0,type:"phone",errmsg:"请输入正确的手机号!!"},{name:"code",type:"required",errmsg:"请输入验证码"},{name:"code",type:"lengthRange",min:6,max:6,errmsg:"请正确输入验证码"}],t=this.$validate.validate(this.valiFormData,n);return!!t.isOk||(e.showToast({icon:"none",title:t.errmsg}),!1)},onSubmit:function(){var e=this.checkAdd();e&&this.addPatient(this.valiFormData.cardNumber)},addPatient:function(n){var t=this;return c(i.default.mark((function a(){var r,u,c;return i.default.wrap((function(i){while(1)switch(i.prev=i.next){case 0:return r=t,r.getCardInfo(n),u={smsCode:r.valiFormData.code,mobile:r.valiFormData.phone,name:r.valiFormData.name,idCard:r.valiFormData.cardNumber,gender:r.valiFormData.sex,birthday:r.valiFormData.birthday,isDefault:r.valiFormData.isDefault},i.next=5,(0,o.addPatient)(u);case 5:c=i.sent,1e5==c.code&&e.showModal({title:"添加成功",showCancel:!1,success:function(){e.setStorageSync("isAdd",!0),e.navigateBack({delta:1})}}),console.log(c);case 8:case"end":return i.stop()}}),a)})))()},getCardInfo:function(e){console.log(e);var n=(0,a.getIdCardInfo)(e);console.log(n),n&&(this.valiFormData.age=n.age,this.valiFormData.birthday=n.birthday,this.valiFormData.sex=n.sex)}},props:{tabCur:{type:Number,default:0}},onUnload:function(){console.log("就诊人页面关闭")}};n.default=l}).call(this,t("543d")["default"])},"6ac9":function(e,n,t){"use strict";t.r(n);var i=t("2449"),a=t.n(i);for(var o in i)"default"!==o&&function(e){t.d(n,e,(function(){return i[e]}))}(o);n["default"]=a.a},"6afa":function(e,n,t){"use strict";(function(e){t("ecea");i(t("66fd"));var n=i(t("c29d"));function i(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=t,e(n.default)}).call(this,t("543d")["createPage"])},"9ea2":function(e,n,t){"use strict";t.d(n,"b",(function(){return a})),t.d(n,"c",(function(){return o})),t.d(n,"a",(function(){return i}));var i={uniSection:function(){return t.e("components/uni-section/uni-section").then(t.bind(null,"d61b"))},uniForms:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uni-forms/components/uni-forms/uni-forms")]).then(t.bind(null,"7fed"))},uniFormsItem:function(){return t.e("uni_modules/uni-forms/components/uni-forms-item/uni-forms-item").then(t.bind(null,"c251"))},uniEasyinput:function(){return t.e("uni_modules/uni-easyinput/components/uni-easyinput/uni-easyinput").then(t.bind(null,"662b"))},uSwitch:function(){return Promise.all([t.e("common/vendor"),t.e("uni_modules/uview-ui/components/u-switch/u-switch")]).then(t.bind(null,"4e4c"))},cpButton:function(){return t.e("components/cp-button/cp-button").then(t.bind(null,"3c98"))}},a=function(){var e=this,n=e.$createElement;e._self._c},o=[]},ae34:function(e,n,t){},c29d:function(e,n,t){"use strict";t.r(n);var i=t("9ea2"),a=t("6ac9");for(var o in a)"default"!==o&&function(e){t.d(n,e,(function(){return a[e]}))}(o);t("d98b");var r,u=t("f0c5"),c=Object(u["a"])(a["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],r);n["default"]=c.exports},d98b:function(e,n,t){"use strict";var i=t("ae34"),a=t.n(i);a.a}},[["6afa","common/runtime","common/vendor"]]]);